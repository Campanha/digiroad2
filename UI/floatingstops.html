<!DOCTYPE html>
<html>
<head>
    <script type="text/javascript" src="bower_components/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="bower_components/jquery-migrate/jquery-migrate.min.js"></script>
    <script type="text/javascript" src="bower_components/lodash/dist/lodash.min.js"></script>
    <script type="text/javascript" src="src/utils/backend-utils.js"></script>
    <script type="text/javascript" src="src/utils/environment-utils.js"></script>
    <script type="text/javascript" src="src/analytics.js"></script>
    <link rel="stylesheet" type="text/css" href="css/digiroad2.css">
    <!-- Google Analytics loaded asynchronously -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    </script>
    <title>Digiroad 2 kelluvat pys채kit</title>
</head>
<body onload="fetchFloatingStops()" style="overflow: auto;">
    <div class="page">
        <div class="content-box">
            <header>Geometrian ulkopuolelle j채채neet pys채kit</header>
            <div class="floating-stops">                         
            </div>
        </div>
    </div>
    <script type="application/javascript">
        var floatingStopsTableForMunicipality = function(municipalityName, externalIds) {
            var tableHeaderRow = function(municipalityName) {
                return $('<caption/>').html(municipalityName);
            };
            var assetLink = function(externalId) {
                var link =  Environment.urlPath() + '/#/asset/' + externalId;
                return $('<a/>').attr('href', link).html(link);
            };
            var tableContentRows = function(externalIds) {
                return _.map(externalIds, function(id) {
                    return $('<tr/>').append($('<td/>').append(assetLink(id)));
                });
            };
            return $('<table/>').addClass('table').append(tableHeaderRow(municipalityName)).append(tableContentRows(externalIds));
        };

        var fetchFloatingStops = function() {
            var backend = new Backend();
            backend.getFloatingAssetsWithCallback(function(assets) {
                _.map(assets, function(externalIds, municipalityName) {
                    $('.floating-stops').append(floatingStopsTableForMunicipality(municipalityName, externalIds));
                });
            });
        };
    </script>
    <script type="application/javascript">
        Analytics.start();
    </script>
</body>
</html>
